# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# This workflow will install Deno and run tests across stable and nightly builds on Windows, Ubuntu and macOS.
# For more information see: https://github.com/denolib/setup-deno

name: Deno

on:
  push:
    branches: [main]
    paths-ignore: '**/README.md'
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest 

    steps:
      - name: Setup repo
        uses: actions/checkout@v2

      - name: Setup Deno
        uses: denolib/setup-deno@v2
        with:
          deno-version: "v1.x" # tests across multiple Deno versions
      - name: Install Denon
        run: deno install -qAf --unstable https://deno.land/x/denon/denon.ts 
          
      - name: Cache Dependencies
        run: denon cache:deps

      - name: Run Tests
        run: denon test:unit

      - name: Deploy
        uses: akhileshns/heroku-deploy@v3.12.12
        with:
          heroku_api_key: ${{secrets.HEROKU_API_KEY}}
          heroku_app_name: "name-that-gif" #Must be unique in Heroku
          heroku_email: "palaciowagner@gmail.com"
          usedocker: true
  
      
